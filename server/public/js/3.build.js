webpackJsonp([3],{37:function(t,o,a){a(56);var e=a(6)(a(41),a(52),"data-v-edbf659e",null);t.exports=e.exports},41:function(t,o,a){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var e=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(t[e]=a[e])}return t},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=a(0);o.default={data:function(){return{reponame:"",collaborators:[],collaboratorsDisplay:[],colSelected:[],autoinit:!1,repoDone:!1,webhook:[],hookDone:!1,defaultHook:"http://github.medialand.tw/api/github/webhook",hookToAdd:""}},watch:{colSelected:function(t){for(var o=this,a=0;a<this.collaborators.length;a++){var e=function(a){var e=!1;if(t.forEach(function(t){t===o.collaborators[a].login&&(e=!0)}),!e&&"admin"!==o.me.role)return o.colSelected.push(o.collaborators[a].login),{v:swal("Oops...","你沒有權限移除原有的協作者喔","error")}}(a);if("object"===(void 0===e?"undefined":s(e)))return e.v}return""}},computed:e({},(0,l.mapGetters)(["me","userlist"]),{title:function(){return"add"===this.$route.params.type?"新增Repository":"Repository資料"},subtitle:function(){return""}}),methods:e({},(0,l.mapMutations)(["setCoverloading"]),(0,l.mapActions)(["addRepo","updateRepo","getuserlist","loadRepo","loadCollaborators","loadHook","addHook","delHook"]),{onCancel:function(){this.$router.push("/repos")},onSubmit:function(){var t=this,o={},a="updateRepo";return"add"===this.$route.params.type?(a="addRepo",o.init="no",this.autoinit&&(o.init="yes")):o.oname=this.$route.params.type,""===this.reponame?swal("Oops..","請填寫Repository的名稱","error"):(o.name=this.reponame,o.cols=this.colSelected.join(),swal({title:"",text:"送出中",type:"info",allowOutsideClick:!1,showConfirmButton:!1}),this[a](o).then(function(o){swal.close(),"OK"===o.status?t.$router.push("/repos"):swal("Oops",o.err.message,"error")}))},dealCollaboratorsList:function(){var t=this;this.userlist.forEach(function(o){t.collaboratorsDisplay.push({login:o.login,avatar_url:o.avatar_url,email:o.email,check:!1})}),this.collaborators.forEach(function(o){for(var a=!1,e=0;e<t.collaboratorsDisplay.length;e++){var s=t.collaboratorsDisplay[e];if(s.login===o.login){a=!0,s.check=!0,t.colSelected.push(o.login);break}}a||(t.collaboratorsDisplay.push({login:o.login,avatar_url:o.avatar_url,check:!0}),t.colSelected.push(o.login))}),this.repoDone=!0},fetchData:function(t){var o=this;this.repoDone=!1,this.hookDone=!1;var a=t||this.$route.params.type;return"add"===a?this.dealCollaboratorsList():(this.reponame=a,this.loadCollaborators(this.reponame).then(function(t){"OK"===t.status&&(t.data.forEach(function(t){"MedialandDev"!==t.login&&o.collaborators.push({login:t.login,avatar_url:t.avatar_url})}),o.dealCollaboratorsList(),o.fetchWebhook())}))},fetchWebhook:function(){var t=this;this.loadHook({name:this.reponame}).then(function(o){t.hookDone=!0,"OK"===o.status&&o.data&&o.data.length>=0&&(t.webhook=o.data)})},addWebHook:function(){var t=this;this.hookDone=!1,this.addHook({name:this.reponame,url:this.hookToAdd}).then(function(o){"OK"===o.status?t.hookToAdd=t.defaultHook:swal("Oops",o.err.message,"error"),t.fetchWebhook()})},delWebHook:function(t){var o=this;swal({title:"確定?",text:"刪錯了不要哭喔",type:"warning",showCancelButton:!0,confirmButtonText:"不要囉嗦",cancelButtonText:"對不起我錯了"}).then(function(){o.hookDone=!1,o.delHook({name:o.reponame,id:t}).then(function(t){"OK"!==t.status&&swal("Oops",t.err.message,"error"),o.fetchWebhook()})},function(){})}}),beforeRouteUpdate:function(t,o,a){this.reponame="",this.collaborators=[],this.collaboratorsDisplay=[],this.colSelected=[],this.autoinit=!1,a(),this.fetchData(t.params.type)},created:function(){var t=this;this.hookToAdd=this.defaultHook,setTimeout(function(){0===t.userlist.length?t.getuserlist().then(function(){t.fetchData()}):t.fetchData(),$(t.$el).find("input").eq(0).focus()},30)},beforeDestroy:function(){}}},48:function(t,o,a){o=t.exports=a(5)(),o.push([t.i,".form-group small[data-v-edbf659e]{color:#9e9e9e}.x_title h3[data-v-edbf659e]{margin:5px 0 6px;float:left;display:block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.input-group[data-v-edbf659e],button[data-v-edbf659e]{margin-bottom:0}.cppwd[data-v-edbf659e]{cursor:pointer}.collaboratorsbox[data-v-edbf659e]{width:50%;float:left;padding-top:0}.collaboratorsbox>label[data-v-edbf659e]{width:100%}.collaborators[data-v-edbf659e]{display:table-cell;padding:8px;line-height:1.42857143;vertical-align:middle;width:100%;float:left;cursor:pointer}.collaboratorsbox[data-v-edbf659e]:hover{background-color:#e0f2f1}.collaborators>div[data-v-edbf659e]{float:left}.collaborators input[data-v-edbf659e]{margin-top:14px}.gitprofilepic[data-v-edbf659e]{width:40px;border-radius:5px;overflow:hidden}.gitprofilepic>img[data-v-edbf659e]{width:100%}.collaboratorsInfo[data-v-edbf659e]{margin-left:10px}.collaboratorsLogin[data-v-edbf659e]{font-weight:700}",""])},52:function(t,o){t.exports={render:function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("div",[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"x_panel"},[a("div",{staticClass:"x_title"},[a("h3",[t._v(t._s(t.title))]),a("div",{staticClass:"clearfix"})]),a("div",{staticClass:"x_content"},[a("form",{staticClass:"form-horizontal form-label-left"},[a("div",{staticClass:"form-group"},[t._m(0),a("div",{staticClass:"col-sm-7 col-xs-12"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.reponame,expression:"reponame",modifiers:{trim:!0}}],staticClass:"form-control col-md-7 col-xs-12",attrs:{id:"auto",type:"text"},domProps:{value:t.reponame},on:{keyup:function(o){if(!("button"in o)&&t._k(o.keyCode,"enter",13))return null;t.onSubmit(o)},input:function(o){o.target.composing||(t.reponame=o.target.value.trim())},blur:function(o){t.$forceUpdate()}}}),t._m(1)])]),"add"===t.$route.params.type?a("div",{staticClass:"form-group"},[a("label",{staticClass:"control-label col-sm-3 col-xs-12"},[t._v("是否要自動init")]),a("div",{staticClass:"col-sm-7 col-xs-12"},[a("div",{staticClass:"checkbox"},[a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.autoinit,expression:"autoinit"}],attrs:{type:"checkbox",value:"true"},domProps:{checked:Array.isArray(t.autoinit)?t._i(t.autoinit,"true")>-1:t.autoinit},on:{__c:function(o){var a=t.autoinit,e=o.target,s=!!e.checked;if(Array.isArray(a)){var l=t._i(a,"true");s?l<0&&(t.autoinit=a.concat("true")):l>-1&&(t.autoinit=a.slice(0,l).concat(a.slice(l+1)))}else t.autoinit=s}}}),t._v("自動Init")]),t._m(2)])])]):t._e(),a("div",{staticClass:"form-group"},[a("label",{staticClass:"control-label col-sm-3 col-xs-12"},[t._v("協作者")]),a("div",{staticClass:"col-sm-7 col-xs-12"},t._l(t.collaboratorsDisplay,function(o){return a("div",{key:o.login,staticClass:"checkbox collaboratorsbox"},[a("label",[a("div",{staticClass:"collaborators"},[a("div",{staticClass:"collaboratorscheck"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.colSelected,expression:"colSelected"}],attrs:{type:"checkbox"},domProps:{value:o.login,checked:Array.isArray(t.colSelected)?t._i(t.colSelected,o.login)>-1:t.colSelected},on:{__c:function(a){var e=t.colSelected,s=a.target,l=!!s.checked;if(Array.isArray(e)){var i=o.login,r=t._i(e,i);l?r<0&&(t.colSelected=e.concat(i)):r>-1&&(t.colSelected=e.slice(0,r).concat(e.slice(r+1)))}else t.colSelected=l}}})]),a("div",{staticClass:"gitprofilepic"},[a("img",{attrs:{src:o.avatar_url}})]),a("div",{staticClass:"collaboratorsInfo"},[a("div",{staticClass:"collaboratorsLogin"},[t._v(t._s(o.login))]),a("div",{staticClass:"collaboratorsEmail"},[a("small",[t._v(t._s(o.email))])])])])])])}))]),a("div",{staticClass:"ln_solid"}),a("div",{staticClass:"col-xs-12 flex-cc"},[a("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:t.onCancel}},[t._v("取消")]),a("button",{staticClass:"btn btn-success",attrs:{type:"button"},on:{click:t.onSubmit}},[t._v("送出")])])])]),t.repoDone?t._e():a("div",{staticClass:"inloading"},[a("i",{staticClass:"fa fa-circle-o-notch fa-spin"})])]),""!==t.reponame?a("div",{staticClass:"x_panel"},[t._m(3),a("div",{staticClass:"x_content"},[a("form",{staticClass:"form-horizontal form-label-left"},[t._l(t.webhook,function(o){return a("div",{key:o.id,staticClass:"form-group"},[a("label",{staticClass:"control-label col-sm-3 col-xs-12"},[t._v(t._s(o.id))]),a("div",{staticClass:"col-sm-7 col-xs-12"},[a("div",{staticClass:"col-sm-10"},[a("div",{staticClass:"collaboratorsInfo"},[a("div",{staticClass:"collaboratorsLogin",staticStyle:{"font-weight":"100"}},[t._v(t._s(o.config.url))]),a("div",{staticClass:"collaboratorsEmail"},[a("small",[t._v("狀態：")]),200===o.last_response.code?a("i",{staticClass:"fa fa-check",staticStyle:{color:"green"}}):t._e(),422===o.last_response.code?a("i",{staticClass:"fa fa-exclamation",staticStyle:{color:"red"}}):t._e(),0===o.last_response.code?a("i",{staticClass:"fa fa-question",staticStyle:{color:"orange"}}):t._e(),a("small",[t._v(" "+t._s(o.last_response.message))])]),o.config.url===t.defaultHook?a("div",{staticClass:"collaboratorsEmail"},[a("small",[a("a",{attrs:{href:"http://github.medialand.tw/api/github/hookevent?q="+t.reponame,target:"_blank"}},[t._v("查詢網址"),a("i",{staticClass:"fa fa-external-link"})])])]):t._e()])]),a("div",{staticClass:"col-sm-2"},[a("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(a){t.delWebHook(o.id)}}},[t._v("刪除")])])])])}),a("div",{staticClass:"form-group"},[a("label",{staticClass:"control-label col-sm-3 col-xs-12"},[t._v("Add WebHook")]),a("div",{staticClass:"col-sm-7 col-xs-12"},[a("div",{staticClass:"col-sm-10"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.hookToAdd,expression:"hookToAdd"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.hookToAdd},on:{input:function(o){o.target.composing||(t.hookToAdd=o.target.value)}}})]),a("div",{staticClass:"col-sm-2"},[a("button",{staticClass:"btn btn-success",attrs:{type:"button"},on:{click:t.addWebHook}},[t._v("新增")])])])])],2)]),t.hookDone?t._e():a("div",{staticClass:"inloading"},[a("i",{staticClass:"fa fa-circle-o-notch fa-spin"})])]):t._e()])])])},staticRenderFns:[function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("label",{staticClass:"control-label col-sm-3 col-xs-12"},[t._v("Repo名稱"),a("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("small",[t._v("為了方便識別專案，請盡量依照「年_月_客戶_專案名稱」的方式來命名。"),a("br"),t._v("所有人都有權限開啟GitHub，並加入協作者，但只有Admin才有權限移除協作者。")])},function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("p",[a("small",[t._v("如果選擇自動Init，第一次請用clone。")])])},function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("div",{staticClass:"x_title"},[a("h3",[t._v("WebHook")]),a("div",{staticClass:"clearfix"}),a("small",[t._v("這裡可以加上WebHook，當repo有push時就會通知。"),a("br"),t._v("預設的網址是這個系統承接GitHub WebHook的網址，加入預設的WebHook網址後，下方會顯示可查詢Repo HEAD的網址，第三方可以藉由這個網址取得repo目前HEAD資訊。通常一開始加入WebHook時，資訊會是null，只要push過一次，就會顯示最新的HEAD。"),a("br"),t._v("如果有自己想把WebHook接到別的網址，請自行填寫，並編寫程式。"),a("br"),t._v("GitHub WebHook的payload請參考"),a("a",{attrs:{href:"https://developer.github.com/v3/repos/hooks/#receiving-webhooks",target:"_blank"}},[t._v("【官方文件"),a("i",{staticClass:"fa fa-external-link"}),t._v("】")])])])}]}},56:function(t,o,a){var e=a(48);"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);a(7)("cc848c06",e,!0)}});